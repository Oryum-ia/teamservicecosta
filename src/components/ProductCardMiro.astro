---
// ProductCard Component - Miro Style
interface Props {
  name: string;
  model: string;
  price: string;
  image?: string;
  available?: boolean;
}

const { name, model, price, image, available = true } = Astro.props;

// Generate unique ID from name
const productId = name.toLowerCase().replace(/\s+/g, '-');
---

<div class="product-card" data-product-id={productId}>
  <div class="product-image">
    {image ? (
      <img src={image} alt={name} loading="lazy" />
    ) : (
      <div class="image-placeholder">
        <svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round">
          <path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"></path>
        </svg>
      </div>
    )}
    {!available && (
      <div class="badge badge-unavailable">
        <span class="badge-dot"></span>
        Agotado
      </div>
    )}
    {available && (
      <div class="badge badge-available">
        <span class="badge-dot"></span>
        Disponible
      </div>
    )}
  </div>

  <div class="product-info">
    <div class="product-header">
      <h3 class="product-name">{name}</h3>
      <p class="product-model">{model}</p>
    </div>

    <div class="product-price">
      <span class="price-currency">COP</span>
      <span class="price-amount">$ {price}</span>
    </div>

    <div class="product-actions">
      <button class="btn btn-primary btn-add-cart" data-product-id={productId} data-product-image={image}>
        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="9" cy="21" r="1"></circle>
          <circle cx="20" cy="21" r="1"></circle>
          <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
        </svg>
        Agregar al carrito
      </button>
      <button class="btn btn-secondary view-details-btn" data-id={productId}>Ver detalles</button>
    </div>
  </div>
</div>

<style>
  .product-card {
    background: var(--color-white);
    border: 1px solid var(--color-gray-200);
    border-radius: var(--radius-2xl);
    overflow: hidden;
    transition: all var(--transition-base);
    display: flex;
    flex-direction: column;
    height: 100%;
    position: relative;
  }

  .product-card:hover {
    border-color: var(--color-primary);
    box-shadow: 0 12px 32px -12px rgba(255, 208, 47, 0.25);
    transform: translateY(-8px);
  }

  .product-image {
    position: relative;
    background: linear-gradient(135deg, #FAFAFA 0%, #F4F4F5 100%);
    padding: var(--spacing-4);
    display: flex;
    align-items: center;
    justify-content: center;
    width: 100%;
    height: 160px;
    overflow: hidden;
  }

  .product-image::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(135deg, rgba(255, 208, 47, 0.05) 0%, rgba(255, 208, 47, 0.1) 100%);
    opacity: 0;
    transition: opacity var(--transition-base);
  }

  .product-card:hover .product-image::before {
    opacity: 1;
  }

  .product-image img {
    width: 100%;
    max-width: 120px;
    height: 120px;
    object-fit: cover;
    transition: transform 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
    position: relative;
    z-index: 1;
    border-radius: var(--radius-md);
  }

  .product-card:hover .product-image img {
    transform: scale(1.1);
  }

  .image-placeholder {
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--color-gray-300);
    padding: var(--spacing-12);
    position: relative;
    z-index: 1;
  }

  .badge {
    position: absolute;
    top: var(--spacing-4);
    right: var(--spacing-4);
    display: inline-flex;
    align-items: center;
    gap: var(--spacing-2);
    padding: var(--spacing-2) var(--spacing-4);
    border-radius: var(--radius-full);
    font-size: var(--text-xs);
    font-weight: var(--font-semibold);
    text-transform: uppercase;
    letter-spacing: 0.05em;
    backdrop-filter: blur(10px);
    z-index: 2;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  }

  .badge-dot {
    width: 6px;
    height: 6px;
    border-radius: 50%;
    animation: pulse-dot 2s infinite;
  }

  @keyframes pulse-dot {
    0%, 100% {
      opacity: 1;
    }
    50% {
      opacity: 0.5;
    }
  }

  .badge-available {
    background: rgba(34, 197, 94, 0.15);
    color: #16a34a;
    border: 1px solid rgba(34, 197, 94, 0.3);
  }

  .badge-available .badge-dot {
    background: #16a34a;
  }

  .badge-unavailable {
    background: rgba(239, 68, 68, 0.15);
    color: #dc2626;
    border: 1px solid rgba(239, 68, 68, 0.3);
  }

  .badge-unavailable .badge-dot {
    background: #dc2626;
  }

  .product-info {
    padding: var(--spacing-3);
    display: flex;
    flex-direction: column;
    gap: var(--spacing-2);
    flex: 1;
  }

  .product-header {
    flex: 1;
  }

  .product-name {
    font-size: var(--text-sm);
    font-weight: var(--font-bold);
    color: var(--color-black);
    margin: 0;
    line-height: 1.3;
    letter-spacing: -0.01em;
  }

  .product-model {
    font-size: 10px;
    color: var(--color-gray-500);
    margin: 0;
    font-weight: var(--font-medium);
  }

  .product-price {
    display: flex;
    align-items: baseline;
    gap: var(--spacing-1);
  }

  .price-currency {
    font-size: 9px;
    color: var(--color-gray-500);
    font-weight: var(--font-semibold);
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }

  .price-amount {
    font-size: var(--text-lg);
    color: var(--color-black);
    font-weight: var(--font-black);
    line-height: 1;
    letter-spacing: -0.02em;
  }

  .product-actions {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-2);
  }

  .btn {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: var(--spacing-1-5);
    padding: var(--spacing-2) var(--spacing-3);
    border: none;
    border-radius: var(--radius-md);
    font-size: 11px;
    font-weight: var(--font-semibold);
    cursor: pointer;
    transition: all var(--transition-base);
    font-family: var(--font-primary);
  }

  .btn svg {
    width: 14px;
    height: 14px;
  }

  .btn-primary {
    background: var(--color-accent);
    color: var(--color-white);
    box-shadow: 0 4px 12px rgba(66, 98, 255, 0.2);
    position: relative;
    overflow: hidden;
  }

  .btn-primary::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
    transition: left 0.5s;
  }

  .btn-primary:hover::before {
    left: 100%;
  }

  .btn-primary:hover {
    background: #3451E6;
    box-shadow: 0 6px 16px rgba(66, 98, 255, 0.3);
    transform: translateY(-2px);
  }

  .btn-primary:active {
    transform: translateY(0);
  }

  .btn-secondary {
    background: var(--color-white);
    color: var(--color-black);
    border: 1px solid var(--color-gray-300);
    position: relative;
    overflow: hidden;
  }

  .btn-secondary::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(0, 0, 0, 0.05), transparent);
    transition: left 0.5s;
  }

  .btn-secondary:hover::before {
    left: 100%;
  }

  .btn-secondary:hover {
    background: var(--color-gray-50);
    border-color: var(--color-primary);
    color: var(--color-primary-dark);
    transform: translateY(-1px);
  }

  .btn-primary:disabled {
    background: var(--color-gray-300);
    cursor: not-allowed;
    opacity: 0.6;
  }

  .btn-primary:disabled:hover {
    transform: none;
  }

  /* Responsive */
  @media (max-width: 640px) {
    .product-image {
      height: 140px;
      padding: var(--spacing-3);
    }

    .product-image img {
      max-width: 100px;
      height: 100px;
    }

    .image-placeholder svg {
      width: 70px;
      height: 70px;
    }

    .product-name {
      font-size: var(--text-lg);
    }

    .price-amount {
      font-size: var(--text-2xl);
    }

    .btn {
      padding: var(--spacing-2-5) var(--spacing-4);
    }
  }
</style>

<script>
  // Handle view details buttons
  document.addEventListener('DOMContentLoaded', () => {
    const viewDetailsButtons = document.querySelectorAll('.view-details-btn');
    viewDetailsButtons.forEach(button => {
      button.addEventListener('click', (e) => {
        const btn = e.currentTarget as HTMLButtonElement;
        const productCard = btn.closest('.product-card');

        if (productCard) {
          const id = btn.dataset.id || '';
          const name = productCard.querySelector('.product-name')?.textContent || '';
          const model = productCard.querySelector('.product-model')?.textContent || '';
          const priceElement = productCard.querySelector('.price-amount')?.textContent || '$0';
          const price = priceElement.replace('$ ', '').trim();
          const imgElement = productCard.querySelector('.product-image img') as HTMLImageElement;
          const image = imgElement?.src || '';
          const availableBadge = productCard.querySelector('.badge-available');
          const available = !!availableBadge;

          // Open modal with product data
          if (typeof (window as any).openProductDetailModal === 'function') {
            (window as any).openProductDetailModal({
              id,
              name,
              model,
              price,
              image,
              available
            });
          }
        }
      });
    });
  });
</script>
